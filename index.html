<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Magic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f4f7ff;
      color: #1f2933;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px 12px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
      padding: 24px 20px 28px;
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .title-block h1 {
      font-size: 1.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-block p {
      margin-top: 4px;
      color: #4b5563;
      font-size: 0.95rem;
    }

    .badge {
      background: #e0ecff;
      color: #1d4ed8;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
    }

    .language-select {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      background: #f3f4f6;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .language-select select {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 2px 8px;
      font-size: 0.85rem;
      background: white;
      outline: none;
    }

    .tabs {
      display: inline-flex;
      border-radius: 999px;
      background: #e5e7eb;
      padding: 4px;
      gap: 4px;
      margin-top: 10px;
    }

    .tab {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      background: transparent;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tab.active {
      background: #2563eb;
      color: #ffffff;
    }

    .card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 16px 16px 18px;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
    }

    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card p.subtitle {
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .mascot-card {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #eff6ff;
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px dashed #bfdbfe;
    }

    .mascot-emoji {
      font-size: 1.8rem;
    }

    .mascot-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .mascot-title {
      font-weight: 700;
      font-size: 0.95rem;
    }

    .mascot-subtitle {
      font-size: 0.85rem;
      color: #4b5563;
    }

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
      align-items: flex-end;
    }

    .field {
      flex: 1 1 140px;
      min-width: 0;
    }

    .field label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #374151;
      font-weight: 500;
    }

    .field input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .field input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.2);
    }

    .btn-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    button.calculate-btn {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 999px;
      padding: 8px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s, background 0.1s;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.35);
    }

    button.calculate-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    button.calculate-btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(37, 99, 235, 0.4);
    }

    .hint-text {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .mic-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 1rem;
      cursor: pointer;
      background: #fee2e2;
      color: #b91c1c;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .mic-btn span {
      font-size: 0.8rem;
    }

    .result-section {
      margin-top: 10px;
      border-radius: 12px;
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      padding: 10px 12px;
      font-size: 0.95rem;
    }

    .result-main {
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .result-main span.equation {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .result-sentence {
      font-size: 0.9rem;
      color: #374151;
      margin-bottom: 4px;
    }

    .factor-section {
      background: #f9fafb;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px dashed #d1d5db;
      font-size: 0.9rem;
    }

    .factor-section h3 {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .factor-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .factor-item {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
    }

    .equation-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .error {
      margin-top: 6px;
      color: #b91c1c;
      font-size: 0.85rem;
    }

    .panel {
      /* just for clarity if needed later */
    }

    @media (max-width: 600px) {
      .app {
        padding: 18px 14px 20px;
      }

      .title-block h1 {
        font-size: 1.5rem;
      }

      .header-right {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="title-block">
        <h1 id="siteTitle">ü™Ñ Math Magic</h1>
        <p id="siteSubtitle">Play with division and times tables ‚Äî made by kids, for kids!</p>

        <div class="tabs">
          <button class="tab active" type="button" data-panel="division" id="tabDivision">
            ‚ûó <span id="tabDivisionLabel">Division</span>
          </button>
          <button class="tab" type="button" data-panel="tables" id="tabTables">
            ‚úñÔ∏è <span id="tabTablesLabel">Times Tables</span>
          </button>
        </div>

        <div class="card mascot-card">
          <div class="mascot-emoji">ü§ñ</div>
          <div class="mascot-text">
            <div class="mascot-title" id="mascotTitle">Hi, I'm Digi!</div>
            <div class="mascot-subtitle" id="mascotSubtitle">
              Your little math buddy to explore numbers, division, and tables. ‚ú®
            </div>
          </div>
        </div>
      </div>

      <div class="header-right">
        <div class="badge" id="badgeText">
          Built for kids 7‚Äì9 üëßüßëüß†
        </div>
        <div class="language-select">
          <span>üåê</span>
          <label for="languageSelect" id="languageLabel">Language:</label>
          <select id="languageSelect">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
          </select>
        </div>
      </div>
    </header>

    <!-- DIVISION PANEL -->
    <section class="card panel" id="panel-division">
      <h2 id="divisionTitle">Step 1: Enter your division problem ‚úèÔ∏è</h2>
      <p class="subtitle" id="divisionSubtitle">
        Choose a number to share and how many equal groups you want.
      </p>

      <div class="input-row">
        <div class="field">
          <label for="dividend" id="dividendLabel">Number to share (dividend)</label>
          <input type="number" id="dividend" placeholder="e.g. 100" min="1">
        </div>
        <div class="field">
          <label for="divisor" id="divisorLabel">Number of groups (divisor)</label>
          <input type="number" id="divisor" placeholder="e.g. 4" min="1">
        </div>
        <button class="mic-btn" id="micDividend" type="button" title="Speak the number">
          üé§ <span id="micLabel">Say number</span>
        </button>
      </div>

      <div class="btn-row">
        <button class="calculate-btn" id="calculateBtn" type="button">
          <span id="divisionButtonText">Show division</span>
        </button>
        <span class="hint-text" id="divisionHint">
          Try a big number like 250 or 275 too.
        </span>
      </div>
      <div id="error" class="error" style="display:none;"></div>
    </section>

    <section class="card panel" id="panel-division-step2">
      <h2 id="step2Title">Step 2: See the answer & story üí°</h2>
      <p class="subtitle" id="step2Subtitle">
        We‚Äôll show you the answer, the matching times-table fact, and all the factor pairs.
      </p>

      <div id="result" class="result-section" style="display:none;">
        <div class="result-main">
          <span id="resultLabel">Result:</span>
          <span class="equation" id="equationText"></span>
        </div>
        <div class="result-sentence" id="storyText"></div>
        <div class="result-sentence" id="timesText"></div>
      </div>

      <div id="factors" class="factor-section" style="display:none; margin-top:10px;">
        <h3 id="factorTitle">All factor pairs of your number üîç</h3>
        <p id="factorSubtitle" style="margin-bottom:4px; font-size:0.85rem; color:#6b7280;">
          These are all the ways to multiply two whole numbers to reach your starting number.
        </p>
        <div id="factorList" class="factor-list"></div>
      </div>
    </section>

    <!-- TIMES TABLES PANEL -->
    <section class="card panel" id="panel-tables" style="display:none;">
      <h2 id="tablesTitle">Step 3: Explore times tables ‚úñÔ∏è</h2>
      <p class="subtitle" id="tablesSubtitle">
        Pick a number and see its multiplication table.
      </p>

      <div class="input-row">
        <div class="field">
          <label for="ttNumber" id="ttNumberLabel">Table of (number)</label>
          <input type="number" id="ttNumber" placeholder="e.g. 5" min="1">
        </div>
        <div class="field">
          <label for="ttLimit" id="ttLimitLabel">Up to (times)</label>
          <input type="number" id="ttLimit" placeholder="e.g. 10" min="1" value="10">
        </div>
      </div>

      <div class="btn-row">
        <button class="calculate-btn" id="ttBtn" type="button">
          <span id="ttButtonText">Show table</span>
        </button>
      </div>

      <div id="ttError" class="error" style="display:none;"></div>

      <div id="ttResult" class="factor-section" style="display:none; margin-top:10px;">
        <h3 id="ttResultTitle">Your times table</h3>
        <div id="ttList" class="factor-list"></div>
      </div>
    </section>
  </div>

  <script>
    // ---------- ELEMENTS ----------
    const dividendInput = document.getElementById('dividend');
    const divisorInput = document.getElementById('divisor');
    const calculateBtn = document.getElementById('calculateBtn');
    const errorBox = document.getElementById('error');

    const resultBox = document.getElementById('result');
    const equationText = document.getElementById('equationText');
    const storyText = document.getElementById('storyText');
    const timesText = document.getElementById('timesText');

    const factorsBox = document.getElementById('factors');
    const factorList = document.getElementById('factorList');

    const tabs = document.querySelectorAll('.tab[data-panel]');
    const panels = document.querySelectorAll('.panel');

    const languageSelect = document.getElementById('languageSelect');

    const micDividend = document.getElementById('micDividend');

    // Times table elements
    const ttNumberInput = document.getElementById('ttNumber');
    const ttLimitInput = document.getElementById('ttLimit');
    const ttBtn = document.getElementById('ttBtn');
    const ttError = document.getElementById('ttError');
    const ttResult = document.getElementById('ttResult');
    const ttList = document.getElementById('ttList');

    // ---------- LANGUAGE SUPPORT (EN + HI) ----------
    const translations = {
      en: {
        siteTitle: 'ü™Ñ Math Magic',
        siteSubtitle: 'Play with division and times tables ‚Äî made by kids, for kids!',
        tabDivisionLabel: 'Division',
        tabTablesLabel: 'Times Tables',
        mascotTitle: "Hi, I'm Digi!",
        mascotSubtitle: 'Your little math buddy to explore numbers, division, and tables. ‚ú®',
        badgeText: 'Built for kids 7‚Äì9 üëßüßëüß†',
        languageLabel: 'Language:',
        divisionTitle: 'Step 1: Enter your division problem ‚úèÔ∏è',
        divisionSubtitle: 'Choose a number to share and how many equal groups you want.',
        dividendLabel: 'Number to share (dividend)',
        divisorLabel: 'Number of groups (divisor)',
        micLabel: 'Say number',
        divisionButtonText: 'Show division',
        divisionHint: 'Try a big number like 250 or 275 too.',
        step2Title: 'Step 2: See the answer & story üí°',
        step2Subtitle: "We‚Äôll show you the answer, the matching times-table fact, and all the factor pairs.",
        resultLabel: 'Result:',
        factorTitle: 'All factor pairs of your number üîç',
        factorSubtitle: 'These are all the ways to multiply two whole numbers to reach your starting number.',
        tablesTitle: 'Step 3: Explore times tables ‚úñÔ∏è',
        tablesSubtitle: 'Pick a number and see its multiplication table.',
        ttNumberLabel: 'Table of (number)',
        ttLimitLabel: 'Up to (times)',
        ttButtonText: 'Show table',
        ttResultTitle: 'Your times table'
      },
      hi: {
        siteTitle: 'ü™Ñ Math Magic (‡§ó‡§£‡§ø‡§§ ‡§ú‡§æ‡§¶‡•Ç)',
        siteSubtitle: '‡§≠‡§æ‡§ó ‡§î‡§∞ ‡§™‡§π‡§æ‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ñ‡•á‡§≤‡•á‡§Ç ‚Äî ‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ, ‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è!',
        tabDivisionLabel: '‡§≠‡§æ‡§ó (Division)',
        tabTablesLabel: '‡§™‡§π‡§æ‡§°‡§º‡•á (Times Tables)',
        mascotTitle: '‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç ‡§°‡§ø‡•õ‡•Ä ‡§π‡•Ç‡§Å!',
        mascotSubtitle: '‡§Æ‡•à‡§Ç ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡§æ ‡§õ‡•ã‡§ü‡§æ ‡§ó‡§£‡§ø‡§§ ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§π‡•Ç‡§Å ‚Äî ‡§ö‡§≤‡•ã ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç‡•§ ‚ú®',
        badgeText: '7‚Äì9 ‡§∏‡§æ‡§≤ ‡§ï‡•á ‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è üëßüßëüß†',
        languageLabel: '‡§≠‡§æ‡§∑‡§æ:',
        divisionTitle: '‡§™‡§π‡§≤‡§æ ‡§ï‡§¶‡§Æ: ‡§Ö‡§™‡§®‡§æ ‡§≠‡§æ‡§ó ‡§ï‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§≤‡§ø‡§ñ‡•ã ‚úèÔ∏è',
        divisionSubtitle: '‡§ú‡§ø‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Å‡§ü‡§®‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡§ø‡§§‡§®‡•á ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Å‡§ü‡§®‡§æ ‡§π‡•à, ‡§µ‡•ã ‡§≤‡§ø‡§ñ‡•ã‡•§',
        dividendLabel: '‡§ú‡§ø‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Å‡§ü‡§®‡§æ ‡§π‡•à',
        divisorLabel: '‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',
        micLabel: '‡§®‡§Ç‡§¨‡§∞ ‡§¨‡•ã‡§≤‡•ã',
        divisionButtonText: '‡§≠‡§æ‡§ó ‡§¶‡§ø‡§ñ‡§æ‡§ì',
        divisionHint: '250 ‡§Ø‡§æ 275 ‡§ú‡•à‡§∏‡•Ä ‡§¨‡§°‡§º‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§≠‡•Ä ‡§Ü‡§ú‡§º‡§Æ‡§æ ‡§ï‡§∞ ‡§¶‡•á‡§ñ‡•ã‡•§',
        step2Title: '‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§ï‡§¶‡§Æ: ‡§â‡§§‡•ç‡§§‡§∞ ‡§î‡§∞ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§¶‡•á‡§ñ‡•ã üí°',
        step2Subtitle: '‡§π‡§Æ ‡§â‡§§‡•ç‡§§‡§∞, ‡§â‡§∏‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡§æ ‡§™‡§π‡§æ‡§°‡§º‡§æ ‡§î‡§∞ ‡§∏‡§≠‡•Ä ‡§ó‡•Å‡§£‡§®‡§ñ‡§Ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å‡§ó‡•á‡•§',
        resultLabel: '‡§â‡§§‡•ç‡§§‡§∞:',
        factorTitle: '‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§∏‡§æ‡§∞‡•á ‡§ó‡•Å‡§£‡§®‡§ñ‡§Ç‡§° üîç',
        factorSubtitle: '‡§Ø‡•á ‡§µ‡•á ‡§∏‡§≠‡•Ä ‡§§‡§∞‡•Ä‡§ï‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡§∏‡•á ‡§¶‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ó‡•Å‡§£‡§æ ‡§ï‡§∞‡§ï‡•á ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¨‡§®‡§§‡•Ä ‡§π‡•à‡•§',
        tablesTitle: '‡§§‡•Ä‡§∏‡§∞‡§æ ‡§ï‡§¶‡§Æ: ‡§™‡§π‡§æ‡§°‡§º‡§æ ‡§¶‡•á‡§ñ‡•ã ‚úñÔ∏è',
        tablesSubtitle: '‡§ï‡•ã‡§à ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ö‡•Å‡§®‡•ã ‡§î‡§∞ ‡§â‡§∏‡§ï‡§æ ‡§™‡§π‡§æ‡§°‡§º‡§æ ‡§¶‡•á‡§ñ‡•ã‡•§',
        ttNumberLabel: '‡§ï‡§ø‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§™‡§π‡§æ‡§°‡§º‡§æ',
        ttLimitLabel: '‡§ï‡§ø‡§∏ ‡§§‡§ï (‡§ï‡§ø‡§§‡§®‡•Ä ‡§¨‡§æ‡§∞)',
        ttButtonText: '‡§™‡§π‡§æ‡§°‡§º‡§æ ‡§¶‡§ø‡§ñ‡§æ‡§ì',
        ttResultTitle: '‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡§æ ‡§™‡§π‡§æ‡§°‡§º‡§æ'
      }
    };

    function applyLanguage(lang) {
      const t = translations[lang] || translations.en;
      for (const [id, text] of Object.entries(t)) {
        const el = document.getElementById(id);
        if (el) el.textContent = text;
      }
    }

    languageSelect.addEventListener('change', () => {
      applyLanguage(languageSelect.value);
    });

    // ---------- DIVISION LOGIC ----------
    function clearDivisionOutputs() {
      errorBox.style.display = 'none';
      errorBox.textContent = '';
      resultBox.style.display = 'none';
      factorsBox.style.display = 'none';
      equationText.textContent = '';
      storyText.textContent = '';
      timesText.textContent = '';
      factorList.innerHTML = '';
    }

    function calculateDivision() {
      clearDivisionOutputs();

      const dividend = parseInt(dividendInput.value, 10);
      const divisor = parseInt(divisorInput.value, 10);

      if (isNaN(dividend) || isNaN(divisor)) {
        errorBox.style.display = 'block';
        errorBox.textContent = languageSelect.value === 'hi'
          ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§®‡§Ç‡§¨‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§'
          : 'Please enter both numbers.';
        return;
      }
      if (dividend <= 0 || divisor <= 0) {
        errorBox.style.display = 'block';
        errorBox.textContent = languageSelect.value === 'hi'
          ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§∏‡•á ‡§¨‡§°‡§º‡•á ‡§™‡•â‡§ú‡§º‡§ø‡§ü‡§ø‡§µ ‡§®‡§Ç‡§¨‡§∞ ‡§π‡•Ä ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§'
          : 'Please use positive numbers greater than zero.';
        return;
      }

      const quotient = Math.floor(dividend / divisor);
      const remainder = dividend % divisor;

      // Main equation
      const eq = `${dividend} √∑ ${divisor} = ${quotient}` + (remainder ? ` (remainder ${remainder})` : '');
      equationText.textContent = eq;

      // Story sentence
      let story;
      if (languageSelect.value === 'hi') {
        story = remainder === 0
          ? `${dividend} ‡§ï‡•ã ‡§Ö‡§ó‡§∞ ${divisor} ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Å‡§ü‡•á‡§Ç, ‡§§‡•ã ‡§π‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§Æ‡•á‡§Ç ${quotient} ‡§Ü‡§è‡§ó‡§æ‡•§`
          : `${dividend} ‡§ï‡•ã ‡§Ö‡§ó‡§∞ ${divisor} ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Å‡§ü‡•á‡§Ç, ‡§§‡•ã ‡§π‡§∞ ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§Æ‡•á‡§Ç ${quotient} ‡§Ü‡§è‡§ó‡§æ ‡§î‡§∞ ${remainder} ‡§¨‡§ö ‡§ú‡§æ‡§è‡§ó‡§æ‡•§`;
      } else {
        story = remainder === 0
          ? `If you share ${dividend} into ${divisor} equal groups, each group gets ${quotient}.`
          : `If you share ${dividend} into ${divisor} equal groups, each group gets ${quotient} and ${remainder} is left over.`;
      }
      storyText.textContent = story;

      // Times-table connection
      if (remainder === 0) {
        timesText.textContent = `${divisor} √ó ${quotient} = ${dividend}`;
      } else {
        if (languageSelect.value === 'hi') {
          timesText.textContent = `‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§¨‡§æ‡§ï‡•Ä ‡§¨‡§ö‡§æ ‡§π‡•à, ‡§á‡§∏ ‡§≤‡§ø‡§è ${divisor} √ó ${quotient} ‡§∏‡§ø‡§∞‡•ç‡§´ ${divisor * quotient} ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ${dividend} ‡§®‡§π‡•Ä‡§Ç‡•§`;
        } else {
          timesText.textContent = `Because there is a remainder, ${divisor} √ó ${quotient} is only ${divisor * quotient}, not ${dividend}.`;
        }
      }

      resultBox.style.display = 'block';

      // Factor pairs
      const n = dividend;
      const pairs = [];
      for (let i = 1; i * i <= n; i++) {
        if (n % i === 0) {
          const j = n / i;
          pairs.push([i, j]);
        }
      }

      factorList.innerHTML = '';
      pairs.forEach(([a, b]) => {
        const item = document.createElement('div');
        item.className = 'factor-item';

        const mult = document.createElement('span');
        mult.className = 'equation-pill';
        mult.textContent = `${a} √ó ${b} = ${n}`;

        const arrow = document.createElement('span');
        arrow.textContent = '‚Üí';

        const div1 = document.createElement('span');
        div1.className = 'equation-pill';
        div1.textContent = `${n} √∑ ${a} = ${b}`;

        const div2 = document.createElement('span');
        div2.className = 'equation-pill';
        div2.textContent = `${n} √∑ ${b} = ${a}`;

        item.appendChild(mult);
        item.appendChild(arrow);
        item.appendChild(div1);
        item.appendChild(div2);
        factorList.appendChild(item);
      });

      factorsBox.style.display = 'block';
    }

    calculateBtn.addEventListener('click', calculateDivision);
    dividendInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') calculateDivision();
    });
    divisorInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') calculateDivision();
    });

    // ---------- TIMES TABLE LOGIC ----------
    function clearTableOutputs() {
      ttError.style.display = 'none';
      ttError.textContent = '';
      ttResult.style.display = 'none';
      ttList.innerHTML = '';
    }

    function calculateTable() {
      clearTableOutputs();

      const n = parseInt(ttNumberInput.value, 10);
      const limit = parseInt(ttLimitInput.value, 10);

      if (isNaN(n) || isNaN(limit)) {
        ttError.style.display = 'block';
        ttError.textContent = languageSelect.value === 'hi'
          ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ú‡§ó‡§π ‡§®‡§Ç‡§¨‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§'
          : 'Please enter both numbers.';
        return;
      }
      if (n <= 0 || limit <= 0) {
        ttError.style.display = 'block';
        ttError.textContent = languageSelect.value === 'hi'
          ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§∏‡•á ‡§¨‡§°‡§º‡•á ‡§™‡•â‡§ú‡§º‡§ø‡§ü‡§ø‡§µ ‡§®‡§Ç‡§¨‡§∞ ‡§π‡•Ä ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§'
          : 'Please use positive numbers greater than zero.';
        return;
      }

      for (let i = 1; i <= limit; i++) {
        const item = document.createElement('div');
        item.className = 'factor-item';
        item.textContent = `${n} √ó ${i} = ${n * i}`;
        ttList.appendChild(item);
      }

      ttResult.style.display = 'block';
    }

    ttBtn.addEventListener('click', calculateTable);
    ttNumberInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') calculateTable();
    });
    ttLimitInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') calculateTable();
    });

    // ---------- TAB SWITCHING ----------
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.dataset.panel;

        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        panels.forEach(panel => {
          if (target === 'division') {
            // show both division cards, hide tables
            if (panel.id === 'panel-division' || panel.id === 'panel-division-step2') {
              panel.style.display = 'block';
            } else if (panel.id === 'panel-tables') {
              panel.style.display = 'none';
            }
          } else if (target === 'tables') {
            if (panel.id === 'panel-tables') {
              panel.style.display = 'block';
            } else {
              panel.style.display = 'none';
            }
          }
        });
      });
    });

    // ---------- SIMPLE VOICE INPUT (MIC) ----------
    let recognition = null;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
    }

    micDividend.addEventListener('click', () => {
      if (!recognition) {
        alert(languageSelect.value === 'hi'
          ? '‡§á‡§∏ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§'
          : 'Voice input is not supported in this browser.');
        return;
      }

      recognition.lang = languageSelect.value === 'hi' ? 'hi-IN' : 'en-IN';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        // Try to grab only digits from what was spoken
        const digits = transcript.replace(/[^0-9]/g, '');
        if (digits) {
          dividendInput.value = digits;
        } else {
          // fallback: just put the raw text
          dividendInput.value = transcript;
        }
      };

      recognition.onerror = () => {
        alert(languageSelect.value === 'hi'
          ? '‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à‡•§'
          : 'There was a problem with voice input.');
      };

      recognition.start();
    });

    // ---------- INITIAL SETUP ----------
    applyLanguage('en');
  </script>
</body>
</html>
